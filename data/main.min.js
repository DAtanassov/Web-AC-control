var state={},setTemp;function updateStatus(){$.ajax({type:"GET",url:"state",dataType:"json",beforeSend:BeforeSend,success:function(data,status,request){data&&(state=data,updateElements(),Success(data,status,request))},error:function(request,status,error){console.log("error getting state"),onError(request,status,error)},timeout:1e3})}function updateElements(){!0===state.power?($("#power").text(" ON"),$("#power-btn").addClass("btn-success"),$("#power-btn").removeClass("btn-danger")):($("#power").text(" OFF"),$("#power-btn").removeClass("btn-success"),$("#power-btn").addClass("btn-danger")),!0===state.swingvert?($("#swingvert").text("Swing ON"),$("#swing-btn").removeClass("btn-outline-info"),$("#swing-btn").addClass("btn-info")):($("#swingvert").text("Swing OFF"),$("#swing-btn").removeClass("btn-info"),$("#swing-btn").addClass("btn-outline-info")),$("#target_temp").text(state.temp+" °C"),!0===state.econo?($("#econo-btn").removeClass("btn-outline-info"),$("#econo-btn").addClass("btn-info")):($("#econo-btn").removeClass("btn-info"),$("#econo-btn").addClass("btn-outline-info")),!0===state.lowNoise?($("#lowNoise-btn").removeClass("btn-outline-info"),$("#lowNoise-btn").addClass("btn-info")):($("#lowNoise-btn").removeClass("btn-info"),$("#lowNoise-btn").addClass("btn-outline-info")),setModeColor(state.mode),setFanColor(state.fan),document.title=state.deviceName+" v."+state.version,$("#devName").text(state.deviceName)}function BeforeSend(request){$.blockUI({css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}})}function Success(data,status,request){setTimeout($.unblockUI,0)}function onError(request,status,error){setTimeout((function(){$.unblockUI({onUnblock:function(){alert("error: "+request.responseText)}})}),2e3)}function postData(t,p){var e=new XMLHttpRequest;e.open("POST",p,!0),e.setRequestHeader("Content-Type","application/json"),console.log(JSON.stringify(t)),e.send(JSON.stringify(t))}function mode_onclick(mode){state.mode=mode,setModeColor(mode),!0===state.power&&postData(state,"state")}function setModeColor(mode){$(".mode-btn").removeClass("btn-info"),$(".mode-btn").addClass("btn-outline-info"),0===mode?($("#mode_auto").removeClass("btn-outline-info"),$("#mode_auto").addClass("btn-info")):1===mode?($("#mode_cooling").removeClass("btn-outline-info"),$("#mode_cooling").addClass("btn-info")):2===mode?($("#mode_dehum").removeClass("btn-outline-info"),$("#mode_dehum").addClass("btn-info")):3===mode?($("#mode_fan").removeClass("btn-outline-info"),$("#mode_fan").addClass("btn-info")):4===mode&&($("#mode_heating").removeClass("btn-outline-info"),$("#mode_heating").addClass("btn-info"))}function setFanColor(fan){0==fan?($("#fan_auto").removeClass("btn-outline-info"),$("#fan_auto").addClass("btn-info")):($("#fan_auto").removeClass("btn-info"),$("#fan_auto").addClass("btn-outline-info"));for(var i=1;i<=4;++i)i<=fan?$("#fan_lvl_"+i).attr("src","level_"+i+"_on.svg"):$("#fan_lvl_"+i).attr("src","level_"+i+"_off.svg")}function fan_onclick(fan){state.fan=fan,setFanColor(fan),!0===state.power&&postData(state,"state")}function power_onclick(){!0===state.power?(state.power=!1,$("#power").text(" OFF"),$("#power-btn").removeClass("btn-success"),$("#power-btn").addClass("btn-danger")):(state.power=!0,$("#power").text(" ON"),$("#power-btn").removeClass("btn-danger"),$("#power-btn").addClass("btn-success")),postData(state,"state")}function temp_onclick(temp){state.temp+=temp,1==state.mode?state.temp<18&&(state.temp=18):state.temp<16&&(state.temp=16),state.temp>30&&(state.temp=30),$("#target_temp").text(state.temp+" °C"),!0===state.power&&(clearTimeout(setTemp),setTemp=setTimeout((function(){postData(state,"state")}),1e3))}function swing_onclick(){state.swingvert?(state.swingvert=!1,$("#swingvert").text("Swing OFF"),$("#swing-btn").removeClass("btn-info"),$("#swing-btn").addClass("btn-outline-info")):(state.swingvert=!0,$("#swingvert").text("Swing ON"),$("#swing-btn").removeClass("btn-outline-info"),$("#swing-btn").addClass("btn-info")),!0===state.power&&postData(state,"state")}function StepV_onclick(){state.swingvert=!1,$("#swingvert").text("Swing OFF"),$("#swing-btn").removeClass("btn-info"),$("#swing-btn").addClass("btn-outline-info"),!0===state.power&&(stepVState={stepv:!0,swingvert:!1},postData(stepVState,"stepv"))}function econo_onclick(){state.econo?(state.econo=!1,$("#econo-btn").removeClass("btn-info"),$("#econo-btn").addClass("btn-outline-info")):(state.econo=!0,$("#econo-btn").removeClass("btn-outline-info"),$("#econo-btn").addClass("btn-info")),!0===state.power&&postData(state,"econo")}function turbo_onclick(){!0===state.power&&(turboState={turbo:!0},postData(turboState,"turbo"))}function lowNoise_onclick(){state.lowNoise?(state.lowNoise=!1,$("#lowNoise-btn").removeClass("btn-info"),$("#lowNoise-btn").addClass("btn-outline-info")):(state.lowNoise=!0,$("#lowNoise-btn").removeClass("btn-outline-info"),$("#lowNoise-btn").addClass("btn-info")),!0===state.power&&postData(state,"lnoise")}function heat10_onclick(){}$(document).ready(updateStatus);